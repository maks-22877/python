<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>My Profile - Food Boutique</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@500&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="./css/profile.css" />
  <style>
    /* ==== Стилі для модального вікна ==== */
    .modal {
      display: none;
      position: fixed;
      z-index: 9999;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0,0,0,0.5);
      justify-content: center;
      align-items: center;
    }
    .modal-content {
      background: #fff;
      border-radius: 12px;
      padding: 24px;
      width: 90%;
      max-width: 400px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.2);
      animation: fadeIn 0.3s ease;
    }
    .modal-content h2 {
      font-size: 24px;
      font-weight: 600;
      margin-bottom: 16px;
      text-align: center;
    }
    .modal-content input {
      width: 100%;
      padding: 10px;
      margin-bottom: 12px;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 16px;
    }
    .modal-actions {
      display: flex;
      justify-content: space-between;
      gap: 12px;
    }
    .modal-actions button {
      flex: 1;
      padding: 12px;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    #cancelEditBtn {
      background-color: #e0e0e0;
      color: #333;
    }
    #cancelEditBtn:hover {
      background-color: #d0d0d0;
    }
    #saveEditBtn {
      background-color: var(--accent-color);
      color: #fff;
    }
    #saveEditBtn:hover {
      background-color: #5a6f2a;
    }
    @keyframes fadeIn {
      from {opacity:0; transform: translateY(-10px);}
      to {opacity:1; transform: translateY(0);}
    }
  </style>
</head>
<body>
  <header class="header">
    <div class="container header-container">
      <p class="logo"><img class="logo-img" src="./img/icon.svg">Food <span>Boutique</span></p>
      <a href="index.html" class="home-button">Home</a>
      <a href="card.html" class="basket"><img class="basket-img" src="./img/basket.svg">CART(3)</a>
      <a href="profile.html"><img class="logo" src="./img/image-removebg-preview.png" alt="avatar"></a>
    </div>
  </header>

  <!-- AUTH -->
  <section id="auth-section" class="container">
    <h2 id="auth-title">Увійти</h2>
    <div id="auth-error"></div>
    <input type="email" id="loginEmail" placeholder="Email" />
    <input type="password" id="loginPassword" placeholder="Пароль" />
    <button id="loginBtn">Увійти</button>
    <p id="toggleRegister">Не маєте акаунта? <span style="text-decoration: underline; cursor: pointer; color: var(--accent-color);">Зареєструватись</span></p>

    <div id="registerForm" style="display:none; margin-top:20px;">
      <input type="text" id="regName" placeholder="Ім’я" />
      <input type="email" id="regEmail" placeholder="Email" />
      <input type="password" id="regPassword" placeholder="Пароль" />
      <input type="text" id="regPhone" placeholder="Телефон" />
      <button id="registerBtn">Зареєструватись</button>
      <p id="toggleLogin" style="margin-top: 12px; text-align: center; cursor: pointer; color: var(--accent-color);">Вже маєте акаунт? Увійти</p>
    </div>
  </section>

  <!-- PROFILE -->
  <main class="profile container" id="profile-section" style="display:none;">
    <h1 class="profile-title">My Profile</h1>
    <section class="profile-overview">
      <img src="./img/user-avatar.png" alt="User Avatar" class="profile-avatar" id="profileAvatar" />
      <input type="file" id="avatarInput" accept="image/*" style="display:none" />
      <div class="profile-info">
        <h2 class="username" id="profileName">Максим Карпенко</h2>
        <p>Email: <span id="profileEmail">maxkarpenko@gmail.com</span></p>
        <p>Phone: <span id="profilePhone">+380 (99) 123-45-67</span></p>
        <p>Joined: <span id="profileJoined">March 14, 2024</span></p>
        <button class="edit-btn" id="editProfileBtn">Edit Profile</button>

        <!-- Модальне вікно -->
        <div class="modal" id="editModal">
          <div class="modal-content">
            <h2>Редагувати профіль</h2>
            <form id="editForm">
              <input type="text" id="editName" placeholder="Ім'я" />
              <input type="email" id="editEmail" placeholder="Email" />
              <input type="text" id="editPhone" placeholder="Телефон" />
              <div class="modal-actions">
                <button type="button" id="cancelEditBtn">Скасувати</button>
                <button type="submit" id="saveEditBtn">Зберегти</button>
              </div>
            </form>
          </div>
        </div>
      </div>
      <button class="edit-btn" id="logoutBtn" style="background:#b03434; margin-left:16px;">Logout</button>
    </section>

    <section class="order-history">
      <h2>Order History</h2>
      <ul class="orders" id="ordersList">
        <li class="order">
          <div>
            <h3>Order #1045</h3>
            <p>Placed: 10 June 2025</p>
            <p>Status: Delivered</p>
          </div>
          <div>
            <p>Total: ₴389.00</p>
            <a href="#" class="view-btn">View</a>
          </div>
        </li>
      </ul>
    </section>

    <section class="saved-items">
      <h2>Saved Items</h2>
      <div class="saved-products" id="savedItems">
        <div class="product-card">
          <img src="./img/product-1.jpg" alt="Product" />
          <p>Organic Avocados</p>
          <span>₴89.00</span>
        </div>
      </div>
    </section>
  </main>

  <footer class="footer">
    <div class="container">
      <p>© 2025 Food Boutique. All rights reserved.</p>
    </div>
  </footer>

  <script>
    const USERS_KEY = "accounts";
    const CURRENT_KEY = "activeUser";

    const authSection = document.getElementById("auth-section");
    const profileSection = document.getElementById("profile-section");
    const authTitle = document.getElementById("auth-title");
    const authError = document.getElementById("auth-error");

    const loginEmailInput = document.getElementById("loginEmail");
    const loginPasswordInput = document.getElementById("loginPassword");
    const loginBtn = document.getElementById("loginBtn");

    const toggleRegisterLink = document.getElementById("toggleRegister");
    const registerForm = document.getElementById("registerForm");
    const regNameInput = document.getElementById("regName");
    const regEmailInput = document.getElementById("regEmail");
    const regPasswordInput = document.getElementById("regPassword");
    const regPhoneInput = document.getElementById("regPhone");
    const registerBtn = document.getElementById("registerBtn");
    const toggleLoginLink = document.getElementById("toggleLogin");

    const profileAvatar = document.getElementById("profileAvatar");
    const avatarInput = document.getElementById("avatarInput");
    const profileName = document.getElementById("profileName");
    const profileEmail = document.getElementById("profileEmail");
    const profilePhone = document.getElementById("profilePhone");
    const profileJoined = document.getElementById("profileJoined");
    const editProfileBtn = document.getElementById("editProfileBtn");
    const logoutBtn = document.getElementById("logoutBtn");

    const editModal = document.getElementById("editModal");
    const cancelEditBtn = document.getElementById("cancelEditBtn");
    const editForm = document.getElementById("editForm");
    const editName = document.getElementById("editName");
    const editEmail = document.getElementById("editEmail");
    const editPhone = document.getElementById("editPhone");

    function validateEmail(email) {
      const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      return re.test(email);
    }
    function validatePhone(phone) {
      const re = /^[\d\+\-\(\) ]{6,20}$/;
      return re.test(phone);
    }
    function showProfile(user) {
      authSection.style.display = "none";
      profileSection.style.display = "block";
      profileName.textContent = user.name || "Користувач";
      profileEmail.textContent = user.email || "";
      profilePhone.textContent = user.phone || "Не вказано";
      profileJoined.textContent = user.joined || new Date().toLocaleDateString();
      profileAvatar.src = user.avatar || "./img/user-avatar.png";
    }
    function showAuth() {
      authSection.style.display = "block";
      profileSection.style.display = "none";
      authTitle.textContent = "Увійти";
      authError.textContent = "";
      loginEmailInput.value = "";
      loginPasswordInput.value = "";
      registerForm.style.display = "none";
      loginEmailInput.style.display = "block";
      loginPasswordInput.style.display = "block";
      loginBtn.style.display = "block";
      toggleRegisterLink.style.display = "block";
    }
    function checkLogin() {
      const activeUser = JSON.parse(localStorage.getItem(CURRENT_KEY));
      if (activeUser && activeUser.email) showProfile(activeUser);
      else showAuth();
    }

    loginBtn.addEventListener("click", () => {
      authError.textContent = "";
      const email = loginEmailInput.value.trim().toLowerCase();
      const password = loginPasswordInput.value;
      if (!email) return authError.textContent = "Email не може бути порожнім.";
      if (!validateEmail(email)) return authError.textContent = "Некоректний email.";
      if (!password) return authError.textContent = "Пароль не може бути порожнім.";
      const users = JSON.parse(localStorage.getItem(USERS_KEY)) || [];
      const user = users.find(u => u.email === email && u.password === password);
      if (user) {
        localStorage.setItem(CURRENT_KEY, JSON.stringify(user));
        showProfile(user);
      } else authError.textContent = "Невірний email або пароль.";
    });

    registerBtn.addEventListener("click", () => {
      authError.textContent = "";
      const name = regNameInput.value.trim();
      const email = regEmailInput.value.trim().toLowerCase();
      const password = regPasswordInput.value;
      const phone = regPhoneInput.value.trim();
      const joined = new Date().toLocaleDateString();
      if (!name) return authError.textContent = "Ім’я не може бути порожнім.";
      if (!email) return authError.textContent = "Email не може бути порожнім.";
      if (!validateEmail(email)) return authError.textContent = "Некоректний email.";
      if (!password || password.length < 6) return authError.textContent = "Пароль має містити мінімум 6 символів.";
      if (phone && !validatePhone(phone)) return authError.textContent = "Некоректний телефон.";
      let users = JSON.parse(localStorage.getItem(USERS_KEY)) || [];
      if (users.find(u => u.email === email)) return authError.textContent = "Користувач з таким email вже існує.";
      const newUser = { name, email, password, phone, joined };
      users.push(newUser);
      localStorage.setItem(USERS_KEY, JSON.stringify(users));
      localStorage.setItem(CURRENT_KEY, JSON.stringify(newUser));
      showProfile(newUser);
    });

    toggleRegisterLink.addEventListener("click", () => {
      authTitle.textContent = "Реєстрація";
      registerForm.style.display = "block";
      loginEmailInput.style.display = "none";
      loginPasswordInput.style.display = "none";
      loginBtn.style.display = "none";
      toggleRegisterLink.style.display = "none";
      authError.textContent = "";
    });

    toggleLoginLink.addEventListener("click", showAuth);

    logoutBtn.addEventListener("click", () => {
      localStorage.removeItem(CURRENT_KEY);
      showAuth();
    });

    profileAvatar.addEventListener("click", () => avatarInput.click());

    avatarInput.addEventListener("change", () => {
      const file = avatarInput.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function(e) {
        profileAvatar.src = e.target.result;
        let currentUser = JSON.parse(localStorage.getItem(CURRENT_KEY));
        if (currentUser) {
          currentUser.avatar = e.target.result;
          localStorage.setItem(CURRENT_KEY, JSON.stringify(currentUser));
          let users = JSON.parse(localStorage.getItem(USERS_KEY)) || [];
          const idx = users.findIndex(u => u.email === currentUser.email);
          if (idx !== -1) {
            users[idx].avatar = e.target.result;
            localStorage.setItem(USERS_KEY, JSON.stringify(users));
          }
        }
      };
      reader.readAsDataURL(file);
    });

    // ===== MODAL =====
    editProfileBtn.addEventListener('click', () => {
      const user = JSON.parse(localStorage.getItem(CURRENT_KEY));
      if (user) {
        editName.value = user.name || '';
        editEmail.value = user.email || '';
        editPhone.value = user.phone || '';
      }
      editModal.style.display = 'flex';
    });

    cancelEditBtn.addEventListener('click', () => {
      editModal.style.display = 'none';
    });

    window.addEventListener('click', (e) => {
      if (e.target === editModal) editModal.style.display = 'none';
    });

    editForm.addEventListener('submit', (e) => {
      e.preventDefault();
      let currentUser = JSON.parse(localStorage.getItem(CURRENT_KEY));
      if (!currentUser) return;
      currentUser.name = editName.value.trim();
      currentUser.email = editEmail.value.trim();
      currentUser.phone = editPhone.value.trim();
      profileName.textContent = currentUser.name;
      profileEmail.textContent = currentUser.email;
      profilePhone.textContent = currentUser.phone;
      localStorage.setItem(CURRENT_KEY, JSON.stringify(currentUser));
      let users = JSON.parse(localStorage.getItem(USERS_KEY)) || [];
      const idx = users.findIndex(u => u.email === currentUser.email);
      if (idx !== -1) {
        users[idx] = currentUser;
        localStorage.setItem(USERS_KEY, JSON.stringify(users));
      }
      editModal.style.display = 'none';
    });

    document.addEventListener("DOMContentLoaded", checkLogin);
  </script>
</body>
</html>
